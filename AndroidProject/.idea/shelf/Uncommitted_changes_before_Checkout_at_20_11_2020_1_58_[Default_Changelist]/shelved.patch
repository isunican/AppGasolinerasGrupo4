Index: app/src/androidTest/java/com/isunican/proyectobase/views/AnhadirVehiculosITest2.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.isunican.proyectobase.views;\r\n\r\nimport android.app.Activity;\r\nimport android.content.Context;\r\nimport android.widget.ListView;\r\n\r\nimport androidx.test.core.app.ApplicationProvider;\r\nimport androidx.test.espresso.Espresso;\r\nimport androidx.test.espresso.ViewInteraction;\r\nimport androidx.test.ext.junit.runners.AndroidJUnit4;\r\nimport androidx.test.rule.ActivityTestRule;\r\n\r\nimport com.isunican.proyectobase.R;\r\nimport com.isunican.proyectobase.model.Vehiculo;\r\nimport com.isunican.proyectobase.presenter.PresenterVehiculos;\r\n\r\nimport org.junit.After;\r\nimport org.junit.Before;\r\nimport org.junit.Rule;\r\nimport org.junit.Test;\r\nimport org.junit.runner.RunWith;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\nimport static androidx.test.espresso.Espresso.onData;\r\nimport static androidx.test.espresso.Espresso.onView;\r\nimport static androidx.test.espresso.Espresso.openActionBarOverflowOrOptionsMenu;\r\nimport static androidx.test.espresso.action.ViewActions.click;\r\nimport static androidx.test.espresso.action.ViewActions.replaceText;\r\nimport static androidx.test.espresso.assertion.ViewAssertions.matches;\r\nimport static androidx.test.espresso.matcher.RootMatchers.isPlatformPopup;\r\nimport static androidx.test.espresso.matcher.RootMatchers.withDecorView;\r\nimport static androidx.test.espresso.matcher.ViewMatchers.isDisplayed;\r\nimport static androidx.test.espresso.matcher.ViewMatchers.withId;\r\nimport static androidx.test.espresso.matcher.ViewMatchers.withSpinnerText;\r\nimport static androidx.test.espresso.matcher.ViewMatchers.withText;\r\nimport static org.hamcrest.Matchers.allOf;\r\nimport static org.hamcrest.Matchers.containsString;\r\nimport static org.hamcrest.Matchers.endsWith;\r\nimport static org.hamcrest.Matchers.instanceOf;\r\nimport static org.hamcrest.Matchers.is;\r\nimport static org.hamcrest.Matchers.not;\r\nimport static org.junit.Assert.assertEquals;\r\nimport static org.junit.Assert.assertTrue;\r\nimport static org.junit.Assert.fail;\r\n\r\n@RunWith(AndroidJUnit4.class)\r\npublic class AnhadirVehiculosITest2 {\r\n\r\n    //@Rule\r\n    //public ActivityTestRule<MainActivity> mActivityTestRule = new ActivityTestRule<>(MainActivity.class);\r\n\r\n    @Rule\r\n    public ActivityTestRule<VehiclesActivity> mActivityTestRuleVehicle = new ActivityTestRule<>(VehiclesActivity.class);\r\n\r\n    private PresenterVehiculos presenter;\r\n    private Context context;\r\n    private VehiclesActivity activity;\r\n    private ListView vista;\r\n\r\n    //Declaración de los vehículos\r\n    private Vehiculo vehiculoMatriculaDistinta;\r\n    private Vehiculo vehiculoMatriculaIgual;\r\n    private Vehiculo vehiculoAnhadido;\r\n\r\n\r\n    @Before\r\n    public void setUp() throws Exception{\r\n        context = ApplicationProvider.getApplicationContext();\r\n        context.deleteFile(\"vehiculos.txt\");\r\n\r\n        activity =  mActivityTestRuleVehicle.getActivity();\r\n        VehiclesActivity v=((VehiclesActivity) activity);\r\n        presenter=v.getPresenter();\r\n\r\n        vista = (ListView) mActivityTestRuleVehicle.getActivity().findViewById(R.id.listViewVehiculos);\r\n\r\n        //Inicializamos los vehículos\r\n        vehiculoMatriculaDistinta=new Vehiculo(\"Toyota\", \"Celica\", \"1234ABC\", \"Gasolina95\");\r\n        vehiculoMatriculaIgual=new Vehiculo(\"Volkswagen\", \"Golf Mk2\", \"1234BCA\", \"Gasolina95\");\r\n        vehiculoAnhadido=new Vehiculo(\"Honda\", \"Civic\", \"1234BCA\", \"Gasolina95\");\r\n        presenter.anhadirVehiculo(vehiculoAnhadido);\r\n        presenter.escribeVehiculo(vehiculoAnhadido.toString(),context);\r\n\r\n    }\r\n    @Test\r\n    public void matriculaUnicaTest(){\r\n\r\n        //Caso válido IT.1\r\n        try{\r\n            presenter.anhadirVehiculo(vehiculoMatriculaDistinta);\r\n            presenter.escribeVehiculo(vehiculoMatriculaDistinta.toString(),context);\r\n\r\n        } catch (PresenterVehiculos.VehiculoYaExiste e){\r\n            fail();\r\n        };\r\n\r\n        //Caso no válido IT.2\r\n        try{\r\n            presenter.anhadirVehiculo(vehiculoMatriculaIgual);\r\n            presenter.escribeVehiculo(vehiculoMatriculaIgual.toString(),context);\r\n            fail();\r\n        } catch (PresenterVehiculos.VehiculoYaExiste e){\r\n\r\n        };\r\n    }\r\n\r\n\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/androidTest/java/com/isunican/proyectobase/views/AnhadirVehiculosITest2.java	(revision bc78c9cdaa18c70a24b2f5a1fd2d69821b518a55)
+++ app/src/androidTest/java/com/isunican/proyectobase/views/AnhadirVehiculosITest2.java	(date 1605829173741)
@@ -72,7 +72,7 @@
 
         activity =  mActivityTestRuleVehicle.getActivity();
         VehiclesActivity v=((VehiclesActivity) activity);
-        presenter=v.getPresenter();
+        presenter=v. getPresenterVehiculos();
 
         vista = (ListView) mActivityTestRuleVehicle.getActivity().findViewById(R.id.listViewVehiculos);
 
Index: app/src/main/java/com/isunican/proyectobase/views/VehiclesActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.isunican.proyectobase.views;\r\n\r\nimport android.app.AlertDialog;\r\nimport android.content.Context;\r\nimport android.os.Build;\r\nimport android.os.Bundle;\r\nimport android.text.TextUtils;\r\nimport android.view.LayoutInflater;\r\nimport android.view.View;\r\nimport android.view.ViewGroup;\r\nimport android.view.Window;\r\nimport android.widget.AdapterView;\r\nimport android.widget.ArrayAdapter;\r\nimport android.widget.Button;\r\nimport android.widget.EditText;\r\nimport android.widget.ImageView;\r\nimport android.widget.ListView;\r\nimport android.widget.ProgressBar;\r\nimport android.widget.Spinner;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport com.isunican.proyectobase.R;\r\nimport com.isunican.proyectobase.model.Vehiculo;\r\nimport com.isunican.proyectobase.presenter.PresenterVehiculos;\r\n\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\n\r\n\r\npublic class VehiclesActivity extends AppCompatActivity implements\r\n        AdapterView.OnItemSelectedListener {\r\n\r\n    static final String GASOLINA95 = \"Gasolina95\";\r\n    static final String GASOLEOA = \"GasoleoA\";\r\n\r\n    //Opciones del spinner\r\n    String[] combustibles = {GASOLINA95, GASOLEOA};\r\n\r\n    String combustibleActual = combustibles[0];\r\n\r\n    // Vista de lista y adaptador para cargar datos en ella\r\n    ListView listViewVehiculos;\r\n    ArrayAdapter<Vehiculo> adapter;\r\n    List<Vehiculo>vehiculos;\r\n\r\n    // Creacion del PresenterVehiculos\r\n    PresenterVehiculos presenterVehiculos;\r\n\r\n    // Barra de progreso circular para mostar progeso de carga\r\n    ProgressBar progressBar;\r\n\r\n    // Elementos del formulario para anhadir vehiculo\r\n    Button  btnCancelar;\r\n    Button  btnAceptar;\r\n    EditText txtMarca;\r\n    EditText txtModelo;\r\n    EditText txtMatricula;\r\n    Spinner spinerTipoCombustible;\r\n\r\n    /**\r\n     * onCreate\r\n     * <p>\r\n     * Crea los elementos que conforman la actividad\r\n     *\r\n     * @param savedInstanceState parametro\r\n     */\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_vehicle);\r\n        presenterVehiculos = new PresenterVehiculos();\r\n        vehiculos = new ArrayList<>(presenterVehiculos.getVehiculos(VehiclesActivity.this).values());\r\n        formatoLista(vehiculos);\r\n    }\r\n\r\n    /**\r\n     * Permite seleccionar el combustible del vehiculo que se va a anhadir.\r\n     *\r\n     * @param arg0 adapter\r\n     * @param arg1 view\r\n     * @param position int\r\n     * @param id long\r\n     */\r\n    @Override\r\n    public void onItemSelected(AdapterView<?> arg0, View arg1, int position, long id) {\r\n        combustibleActual = combustibles[position];\r\n    }\r\n\r\n    public void anhadirVehiculo(View v){\r\n        AlertDialog.Builder alert;\r\n\r\n        if(Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP){\r\n            alert = new AlertDialog.Builder(this, android.R.style.Theme_Material_Dialog_Alert);\r\n        }\r\n        else{\r\n            alert = new AlertDialog.Builder(this);\r\n        }\r\n        LayoutInflater inflater = getLayoutInflater();\r\n        v.getId();\r\n        View view = inflater.inflate(R.layout.activity_alert_dialog, null);\r\n        alert.setView(view);\r\n\r\n        alert.setCancelable(false);\r\n\r\n        final AlertDialog dialog = alert.create();\r\n        dialog.getWindow().requestFeature(Window.FEATURE_NO_TITLE);\r\n        dialog.show();\r\n\r\n        //Cogemos el spinner\r\n        spinerTipoCombustible = (Spinner) view.findViewById(R.id.idSpinnerCombustible);\r\n        spinerTipoCombustible.setOnItemSelectedListener(this);\r\n\r\n        //Creamos el arrayAdapter con la lista del spinner\r\n        ArrayAdapter<String> aa = new ArrayAdapter<>(this, android.R.layout.simple_spinner_item, combustibles);\r\n        aa.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);\r\n\r\n        //Colocamos los datos en el spinner\r\n        spinerTipoCombustible.setAdapter(aa);\r\n\r\n        txtMarca = view.findViewById(R.id.idIntroduceMarca);\r\n        txtModelo = view.findViewById(R.id.idIntroduceModelo);\r\n        txtMatricula = view.findViewById(R.id.idIntroduceMatricula);\r\n        btnAceptar = view.findViewById(R.id.idBotonAceptar);\r\n        btnCancelar = view.findViewById(R.id.idBotonCancelar);\r\n\r\n        btnAceptar.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                String mar = txtMarca.getText().toString();\r\n                String model = txtModelo.getText().toString();\r\n                String matric = txtMatricula.getText().toString();\r\n                String matricu = matric.toUpperCase();\r\n                Vehiculo vehiculo = new Vehiculo(mar, model, matricu, combustibleActual);\r\n                try {\r\n                    presenterVehiculos.anhadirVehiculo(vehiculo);\r\n                    presenterVehiculos.escribeVehiculo(vehiculo.toString(), VehiclesActivity.this);\r\n\r\n                    Toast.makeText(getApplicationContext(), \"Datos añadidos\", Toast.LENGTH_LONG).show();\r\n                    dialog.dismiss();\r\n\r\n                    //Muestra la list view actualizada con el ultimo vehiculo\r\n                    vehiculos=new ArrayList<>(presenterVehiculos.getVehiculos(VehiclesActivity.this).values());\r\n\r\n                    formatoLista(vehiculos);\r\n\r\n                } catch (PresenterVehiculos.DatoNoValido e) {\r\n                    notificaDatoNoValido();\r\n                }\r\n\r\n                catch (PresenterVehiculos.MatriculaNoValida e) {\r\n                    notificaFormatoMatriculaNoValida();\r\n                }\r\n\r\n                catch (PresenterVehiculos.VehiculoNulo e) {\r\n                    notificaVehiculoExiste();\r\n                }\r\n\r\n                catch (PresenterVehiculos.CombustibleNoValido e) {\r\n                    notificaCombustibleNoValido();\r\n                }\r\n\r\n                catch (PresenterVehiculos.VehiculoYaExiste e) {\r\n                    notificaVehiculoNulo();\r\n                }\r\n\r\n\r\n\r\n            }\r\n        });\r\n\r\n        btnCancelar.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                Toast.makeText(getApplicationContext(), \"Datos eliminados\", Toast.LENGTH_LONG).show();\r\n                dialog.dismiss();\r\n            }\r\n        });\r\n    }\r\n\r\n    private void formatoLista(List<Vehiculo> vehiculos) {\r\n        // Definimos el array adapter\r\n        adapter = new VehiculoArrayAdapter(this,0, vehiculos);\r\n\r\n        // Obtenemos la vista de la lista\r\n        listViewVehiculos = findViewById(R.id.listViewVehiculos);\r\n\r\n        // Cargamos los datos en la lista\r\n        if (!presenterVehiculos.getVehiculos(VehiclesActivity.this).isEmpty()) {\r\n            // datos obtenidos con exito\r\n            listViewVehiculos.setAdapter(adapter);\r\n        }\r\n    }\r\n\r\n    public PresenterVehiculos getPresenterVehiculos(){\r\n        return presenterVehiculos;\r\n    }\r\n\r\n    @Override\r\n    public void onNothingSelected(AdapterView<?> parent) {\r\n        //De momento no hace nada\r\n    }\r\n\r\n    /**\r\n     * Muestra mensaje de error\r\n     */\r\n    private void notificaDatoNoValido() {\r\n        Toast toast;\r\n        toast = Toast.makeText(getApplicationContext(), \"Rellene todos los campos\", Toast.LENGTH_LONG);\r\n        toast.show();\r\n    }\r\n\r\n    /**\r\n     * Muestra mensaje de error\r\n     */\r\n    private void notificaVehiculoExiste() {\r\n        Toast toast;\r\n        toast = Toast.makeText(getApplicationContext(), \"Matricula introducida ya existe\", Toast.LENGTH_LONG);\r\n        toast.show();\r\n    }\r\n\r\n    /**\r\n     * Muestra mensaje de error\r\n     */\r\n    private void notificaFormatoMatriculaNoValida() {\r\n        Toast toast;\r\n        toast = Toast.makeText(getApplicationContext(), \"Formato de matricula incorrecto, formato 9999XXX\", Toast.LENGTH_LONG);\r\n        toast.show();\r\n    }\r\n\r\n    /**\r\n     * Muestra mensaje de error\r\n     */\r\n    private void notificaVehiculoNulo() {\r\n        Toast toast;\r\n        toast = Toast.makeText(getApplicationContext(), \"Vehiculo nulo\", Toast.LENGTH_LONG);\r\n        toast.show();\r\n    }\r\n\r\n    /**\r\n     * Muestra mensaje de error\r\n     */\r\n    private void notificaCombustibleNoValido() {\r\n        Toast toast;\r\n        toast = Toast.makeText(getApplicationContext(), \"Combustible introducido no valido\", Toast.LENGTH_LONG);\r\n        toast.show();\r\n    }\r\n\r\n    /*\r\n    ------------------------------------------------------------------\r\n        VehiculosArrayAdapter\r\n\r\n        Adaptador para inyectar los datos de los vehiculos\r\n        en el listview del layout de vehiculos de la aplicacion\r\n    ------------------------------------------------------------------\r\n    */\r\n    class VehiculoArrayAdapter extends ArrayAdapter<Vehiculo> {\r\n\r\n        private Context context;\r\n        private List<Vehiculo> listaVehiculos;\r\n\r\n\r\n        // Constructor\r\n        public VehiculoArrayAdapter(Context context, int resource, List<Vehiculo> objects) {\r\n            super(context, resource, objects);\r\n            this.context = context;\r\n            this.listaVehiculos = objects;\r\n        }\r\n\r\n        // Llamado al renderizar la lista\r\n        @Override\r\n        public View getView(int position, View convertView, ViewGroup parent) {\r\n\r\n            // Obtiene el elemento que se está mostrando\r\n            Vehiculo vehiculo = listaVehiculos.get(position);\r\n\r\n            // Indica el layout a usar en cada elemento de la lista\r\n            LayoutInflater inflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);\r\n\r\n            View view = inflater.inflate(R.layout.item_vehiculo, null);\r\n\r\n            // Asocia las variables de dicho layout\r\n            ImageView marca = view.findViewById(R.id.logoMarca);\r\n            TextView modelo = view.findViewById(R.id.TextModelo);\r\n            TextView matricula = view.findViewById(R.id.textMatricula);\r\n            TextView combustible = view.findViewById(R.id.textCombustible);\r\n\r\n            // Y carga los datos del item\r\n            modelo.setText(vehiculo.getModelo());\r\n            matricula.setText(vehiculo.getMatricula());\r\n            combustible.setText(vehiculo.getCombustible());\r\n\r\n            // carga icono\r\n            cargaIcono(vehiculo, marca);\r\n\r\n            return view;\r\n        }\r\n\r\n        private void cargaIcono(Vehiculo vehiculo, ImageView logo) {\r\n            String rotuleImageID = vehiculo.getMarca().toLowerCase();\r\n\r\n            // Tengo que protegerme ante el caso en el que el rotulo solo tiene digitos.\r\n            // En ese caso getIdentifier devuelve esos digitos en vez de 0.\r\n            int imageID = context.getResources().getIdentifier(rotuleImageID,\r\n                    \"drawable\", context.getPackageName());\r\n\r\n            if (imageID == 0 || TextUtils.isDigitsOnly(rotuleImageID)) {\r\n                imageID = context.getResources().getIdentifier(getResources().getString(R.string.coche),\r\n                        \"drawable\", context.getPackageName());\r\n            }\r\n            logo.setImageResource(imageID);\r\n        }\r\n    }\r\n    public PresenterVehiculos getPresenter(){\r\n        return presenterVehiculos;\r\n    }\r\n}\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/isunican/proyectobase/views/VehiclesActivity.java	(revision bc78c9cdaa18c70a24b2f5a1fd2d69821b518a55)
+++ app/src/main/java/com/isunican/proyectobase/views/VehiclesActivity.java	(date 1605829122805)
@@ -248,6 +248,9 @@
         toast.show();
     }
 
+    public PresenterVehiculos getPresenter(){
+        return presenterVehiculos;
+    }
     /*
     ------------------------------------------------------------------
         VehiculosArrayAdapter
@@ -313,8 +316,6 @@
             logo.setImageResource(imageID);
         }
     }
-    public PresenterVehiculos getPresenter(){
-        return presenterVehiculos;
-    }
+
 }
 
Index: .idea/modules.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"ProjectModuleManager\">\r\n    <modules>\r\n      <module fileurl=\"file://$PROJECT_DIR$/.idea/modules/AndroidProject.iml\" filepath=\"$PROJECT_DIR$/.idea/modules/AndroidProject.iml\" />\r\n      <module fileurl=\"file://$PROJECT_DIR$/.idea/modules/app/AndroidProject.app.iml\" filepath=\"$PROJECT_DIR$/.idea/modules/app/AndroidProject.app.iml\" />\r\n<<<<<<< HEAD\r\n=======\r\n      <module fileurl=\"file://$PROJECT_DIR$/.idea/modules/AppGasolinerasGrupo4-AndroidProject.iml\" filepath=\"$PROJECT_DIR$/.idea/modules/AppGasolinerasGrupo4-AndroidProject.iml\" group=\"AndroidProject\" />\r\n      <module fileurl=\"file://$PROJECT_DIR$/.idea/modules/AppGasolinerasGrupo4.AndroidProject.iml\" filepath=\"$PROJECT_DIR$/.idea/modules/AppGasolinerasGrupo4.AndroidProject.iml\" />\r\n      <module fileurl=\"file://$PROJECT_DIR$/.idea/modules/app/app.iml\" filepath=\"$PROJECT_DIR$/.idea/modules/app/app.iml\" group=\"AndroidProject/app\" />\r\n\r\n>>>>>>> feature/399084-AnhadirVehiculo\r\n    </modules>\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- .idea/modules.xml	(revision bc78c9cdaa18c70a24b2f5a1fd2d69821b518a55)
+++ .idea/modules.xml	(date 1605825466792)
@@ -2,15 +2,8 @@
 <project version="4">
   <component name="ProjectModuleManager">
     <modules>
-      <module fileurl="file://$PROJECT_DIR$/.idea/modules/AndroidProject.iml" filepath="$PROJECT_DIR$/.idea/modules/AndroidProject.iml" />
+      <module fileurl="file://$PROJECT_DIR$/.idea/AndroidProject.iml" filepath="$PROJECT_DIR$/.idea/AndroidProject.iml" />
       <module fileurl="file://$PROJECT_DIR$/.idea/modules/app/AndroidProject.app.iml" filepath="$PROJECT_DIR$/.idea/modules/app/AndroidProject.app.iml" />
-<<<<<<< HEAD
-=======
-      <module fileurl="file://$PROJECT_DIR$/.idea/modules/AppGasolinerasGrupo4-AndroidProject.iml" filepath="$PROJECT_DIR$/.idea/modules/AppGasolinerasGrupo4-AndroidProject.iml" group="AndroidProject" />
-      <module fileurl="file://$PROJECT_DIR$/.idea/modules/AppGasolinerasGrupo4.AndroidProject.iml" filepath="$PROJECT_DIR$/.idea/modules/AppGasolinerasGrupo4.AndroidProject.iml" />
-      <module fileurl="file://$PROJECT_DIR$/.idea/modules/app/app.iml" filepath="$PROJECT_DIR$/.idea/modules/app/app.iml" group="AndroidProject/app" />
-
->>>>>>> feature/399084-AnhadirVehiculo
     </modules>
   </component>
 </project>
\ No newline at end of file
